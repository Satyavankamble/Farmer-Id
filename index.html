
<!DOCTYPE html>
<html lang="mr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kisan Card</title>
  
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- html2canvas CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <!-- jsPDF CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    .card-box {
      width: 860px;
      height: 540px;
      border: 5px solid #1b8f2e;
      border-radius: 4px;
      position: relative;
      overflow: hidden;
      background: white;
    }
    .top-strip {
      background: linear-gradient(to right,#0d8f2e,#4CAF50);
      padding: 12px;
      border-bottom: 3px solid #1b8f2e;
    }
    .inner-light-border {
      border: 2px solid #97d7a7;
      margin: 10px;
      height: calc(100% - 20px);
    }
    /* Watermark style */
    .watermark {
      opacity: 0.10;
      position: absolute;
      inset: 0;
      z-index: 0; /* Back layer */
      pointer-events: none;
      display: flex;
      justify-content: center;
      align-items: center;
    }
  </style>
</head>

<body class="bg-gray-100 p-6">
<!-- INPUT BOX -->
<div class="max-w-4xl mx-auto bg-white shadow p-4 mb-6 border rounded">
  <h2 class="text-xl text-center font-bold text-green-700 mb-4">Kisan Card Generator</h2>
  <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
    <input id="inpName" class="p-2 border rounded" placeholder="Farmer Name" />
    <input id="inpFid" class="p-2 border rounded" placeholder="Farmer ID" />
    <input id="inpAad" maxlength="12" class="p-2 border rounded" placeholder="Aadhaar Number" />
    <input id="inpMob" maxlength="10" class="p-2 border rounded" placeholder="Mobile Number" />
    <div>
      <label class="font-semibold text-sm">Upload Photo</label>
      <input id="inpPhoto" type="file" class="w-full" accept="image/*" />
    </div>
    <div>
      <label class="font-semibold text-sm">Upload Logo (Watermark)</label>
      <input id="inpLogo" type="file" class="w-full" accept="image/*" />
    </div>
  </div>
  <div class="flex gap-3 mt-4">
    <button onclick="applyData()" class="flex-1 bg-green-600 text-white py-2 rounded">Generate</button>
    <button onclick="downloadPDF()" class="flex-1 bg-blue-600 text-white py-2 rounded">Download PDF</button>
  </div>
</div>

<!-- CARD -->
<div id="cardWrap" class="mx-auto card-box relative" style="position:relative">
  <div class="inner-light-border" style="position:relative">

    <!-- TOP STRIP -->
    <div class="top-strip flex items-center relative" style="z-index:2">
      <img id="logoImg" src="" class="h-16" style="background:#0b931a" />
      <span class="text-white font-extrabold text-4xl ml-6 drop-shadow">किसान कार्ड</span>
    </div>
    <!-- CONTENT -->
    <div class="p-6 grid grid-cols-2 text-lg relative" style="z-index:2">
      <div>
        <p class="text-green-700 font-bold">Farmer Name:-</p>
        <p id="cardName" class="mb-3"></p>
        <p class="text-green-700 font-bold">Farmer ID:-</p>
        <p id="cardFid" class="mb-3"></p>
        <p class="text-green-700 font-bold">Aadhaar Number:-</p>
        <p id="cardAad" class="mb-3"></p>
        <p class="text-green-700 font-bold">Mobile Number:-</p>
        <p id="cardMob" class="mb-3"></p>
      </div>
      <div class="flex flex-col items-end">
        <!-- PHOTO BOX -->
        <div class="w-32 h-40 border shadow bg-gray-100 overflow-hidden">
          <img id="cardPhoto" class="w-full h-full object-cover" />
        </div>
        <p class="mt-2 text-sm font-semibold text-right">Approval Status</p>
        <p class="text-green-700 font-bold text-right">APPROVED</p>
      </div>
    </div>

    <!-- CENTER WATERMARK (PDF + Preview) -->
    <div class="watermark" id="wm">
      <img id="wmLogo" src="" class="w-96" />
    </div>

    <!-- BOTTOM NOTE -->
    <div class="absolute bottom-0 w-full text-center py-2 text-green-800 text-sm border-t border-green-700 bg-white" style="z-index:2">
      टीप :- हे कार्ड शेतकरी कामासाठी तात्पुरत्या स्वरूपात बनवले आहे..
    </div>
  </div>
</div>

<script>
function applyData(){
  cardName.innerText = inpName.value;
  cardFid.innerText = inpFid.value;
  cardAad.innerText = inpAad.value;
  cardMob.innerText = inpMob.value;

  // User photo
  const f = inpPhoto.files[0];
  if (f){
    const reader = new FileReader();
    reader.onload = e => {
      cardPhoto.src = e.target.result;
    };
    reader.readAsDataURL(f);
  } else {
    cardPhoto.src = "";
  }
  // Logo (top and watermark)
  const logo = inpLogo.files[0];
  if (logo){
    const reader2 = new FileReader();
    reader2.onload = e => {
      logoImg.src = e.target.result;
      wmLogo.src = e.target.result;
    };
    reader2.readAsDataURL(logo);
  } else {
    logoImg.src = "";
    wmLogo.src = "";
  }
}

async function downloadPDF(){
  applyData();
  await new Promise(r => setTimeout(r, 100)); // rendering fix

  // Watermark लपवत नाही – direct pdf चालेल

  const card = document.getElementById("cardWrap");
  const canvas = await html2canvas(card, {
    scale: 3,
    useCORS: true,
    allowTaint: true,
    logging: false
  });

  const imgData = canvas.toDataURL("image/png");
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF({
    orientation: "landscape",
    unit: "mm",
    format: [86, 54]
  });

  pdf.addImage(imgData, "PNG", 0, 0, 86, 54);
  pdf.save(`KisanCard_${Date.now()}.pdf`);
}
</script>
</body>
</html>
